<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–î–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
      max-width: 500px;
      width: 100%;
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      color: #333;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }
    input, select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 10px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    .btn:active {
      transform: translateY(0);
    }
    .status {
      margin-top: 20px;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      display: none;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</h1>
    <p class="subtitle">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞</p>
    
    <form id="dataForm">
      <div class="form-group">
        <label for="tipoDocumento">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞</label>
        <select id="tipoDocumento" required>
          <option value="NIE" selected>NIE</option>
          <option value="DNI">DNI</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="numeroNie">–ù–æ–º–µ—Ä NIE</label>
        <input type="text" id="numeroNie" placeholder="Z1868415S" required>
      </div>
      
      <div class="form-group">
        <label for="nombreCompleto">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è</label>
        <input type="text" id="nombreCompleto" placeholder="ANTONII REVSIN" required>
      </div>
      
      <div class="form-group">
        <label for="paisCiudadania">–°—Ç—Ä–∞–Ω–∞ –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–∞</label>
        <input type="text" id="paisCiudadania" placeholder="UCRANIA" value="UCRANIA" required>
      </div>
      
      <button type="submit" class="btn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</button>
    </form>
    
    <div id="status" class="status"></div>
    <button id="stopButton" class="btn btn-stop" style="display: none; margin-top: 20px; background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);">
      üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
    </button>
  </div>

  <script>
    const form = document.getElementById('dataForm');
    const status = document.getElementById('status');
    const stopButton = document.getElementById('stopButton');
    let currentJobId = null;
    let statusInterval = null;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        tipoDocumento: document.getElementById('tipoDocumento').value,
        numeroNie: document.getElementById('numeroNie').value.trim(),
        nombreCompleto: document.getElementById('nombreCompleto').value.trim(),
        paisCiudadania: document.getElementById('paisCiudadania').value.trim() || 'UCRANIA'
      };

      if (!data.numeroNie || !data.nombreCompleto) {
        showStatus('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'error');
        return;
      }

      showStatus('‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä...', 'info');
      
      try {
        const response = await fetch('/api/start-autoclicker1', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
          currentJobId = result.jobId;
          showStatus('‚úÖ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä 1 –∑–∞–ø—É—â–µ–Ω! ID –∑–∞–¥–∞—á–∏: ' + currentJobId + '\n‚è≥ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞...', 'success');
          document.body.style.background = '#d4edda';
          stopButton.style.display = 'block';
          stopButton.disabled = false;
          form.querySelector('button[type="submit"]').disabled = true;
          
          // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
          statusInterval = setInterval(async () => {
            try {
              const statusResponse = await fetch(`/api/status/${jobId}`);
              const statusData = await statusResponse.json();
              
              if (statusData.success && statusData.job) {
                const job = statusData.job;
                if (job.status === 'completed') {
                  clearInterval(statusInterval);
                  stopButton.style.display = 'block';
                  stopButton.disabled = false;
                  form.querySelector('button[type="submit"]').disabled = false;
                  currentJobId = null;
                  showStatus('üéâ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä 1 –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.', 'success');
                } else if (job.status === 'error') {
                  clearInterval(statusInterval);
                  stopButton.style.display = 'block';
                  stopButton.disabled = false;
                  form.querySelector('button[type="submit"]').disabled = false;
                  currentJobId = null;
                  showStatus('‚ùå –û—à–∏–±–∫–∞: ' + (job.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                } else if (job.status === 'stopped') {
                  clearInterval(statusInterval);
                  stopButton.style.display = 'block';
                  stopButton.disabled = false;
                  form.querySelector('button[type="submit"]').disabled = false;
                  currentJobId = null;
                  showStatus('üõë –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä 1 –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'info');
                } else {
                  stopButton.style.display = 'block';
                  stopButton.disabled = false;
                  showStatus('‚è≥ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä 1 —Ä–∞–±–æ—Ç–∞–µ—Ç... –°—Ç–∞—Ç—É—Å: ' + job.status, 'info');
                }
              } else {
                stopButton.style.display = 'block';
                stopButton.disabled = false;
                showStatus('‚è≥ –°—Ç–∞—Ç—É—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–∞.', 'info');
              }
            } catch (error) {
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
              stopButton.style.display = 'block';
              stopButton.disabled = false;
            }
          }, 3000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        } else {
          showStatus('‚ùå –û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
        }
      } catch (error) {
        showStatus('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message, 'error');
      }
    });

    function showStatus(message, type) {
      status.textContent = message;
      status.className = `status ${type}`;
      status.style.display = 'block';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
    stopButton.addEventListener('click', async () => {
      if (!currentJobId) {
        showStatus('‚ÑπÔ∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.', 'info');
        stopButton.style.display = 'block';
        stopButton.disabled = false;
        return;
      }
      
      showStatus('‚è≥ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞...', 'info');
      stopButton.disabled = true;
      
      try {
        const response = await fetch(`/api/stop/${currentJobId}`, {
          method: 'POST'
        });
        
        const result = await response.json();
        
        if (result.success) {
          showStatus('üõë –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'info');
          if (statusInterval) clearInterval(statusInterval);
          stopButton.style.display = 'block';
          stopButton.disabled = false;
          form.querySelector('button[type="submit"]').disabled = false;
          currentJobId = null;
        } else {
          showStatus('‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '\\nüîÑ –ö–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏.', 'error');
          stopButton.disabled = false;
          stopButton.style.display = 'block';
        }
      } catch (error) {
        showStatus('‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ' + error.message + '\\nüîÑ –ö–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏.', 'error');
        stopButton.disabled = false;
        stopButton.style.display = 'block';
      }
    });
  </script>
</body>
</html>

